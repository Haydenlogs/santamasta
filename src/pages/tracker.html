<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff; /* Light Blue */
        }
        .top-bar {
            background-color: #333;
            color: #fff;
            padding: 10px;
            text-align: center;
        }
        #map-container {
            position: relative;
            width: 100%;
            height: 500px; /* Adjust as needed */
            margin-top: 20px;
        }
        #santa {
            position: absolute;
            width: 50px;
            height: 50px;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div id="nextCityInfo"></div>
        <div id="lastCityInfo"></div>
    </div>
    
    <div id="map-container">
        <img id="santa" src="https://cdn.glitch.global/00096ffa-1c6f-46f0-aa52-09cd4de366d6/Santa_1-removebg-preview.png?v=1707774212144">
        <img width="100%" height="100%" src="https://cdn.glitch.global/00096ffa-1c6f-46f0-aa52-09cd4de366d6/satellite-map-of-the-world_wm00875.jpg?v=1707770779809">
    </div>

    <script>
        const nextCityInfo = document.getElementById('nextCityInfo');
        const lastCityInfo = document.getElementById('lastCityInfo');
        const santa = document.getElementById('santa');
        const mapContainer = document.getElementById('map-container');

        const eventSource = new EventSource('/updates');

        eventSource.onmessage = function(event) {
            const data = JSON.parse(event.data);
            updateTracker(data);
        };

        function updateTracker(data) {
            if (data.nextCity && data.timeLeft) {
                nextCityInfo.textContent = `Headed For: ${data.nextCity.city} in ${data.timeLeft} seconds.`;
            } else {
                nextCityInfo.textContent = '';
            }

            if (data.lastCity) {
                lastCityInfo.textContent = `Last Seen: ${data.lastCity.city}, ${data.lastCity.country}`;
            } else {
                lastCityInfo.textContent = '';
            }

            if (data.currentCity && data.currentCity.latitude && data.currentCity.longitude) {
                const { latitude, longitude } = data.currentCity;
                const { width, height } = mapContainer.getBoundingClientRect();
                const x = (longitude + 180) * (width / 360);
                const y = (90 - latitude) * (height / 180);
                santa.style.left = `${x - 25}px`; // Adjust for the size of the Santa image
                santa.style.top = `${y - 25}px`; // Adjust for the size of the Santa image
            }
        }
    </script>
</body>
</html>
