var url=new URL(window.location.href);let placedBaskets=[],power,power2,startallowed=!1,trackeneityenabled=!0,alastthestop5,hereyecomesthestop5,allowedtotrackedentity=!1,iscurrentlydelivering=!0,allowedtohead=!1,imageData,lastcitystopped,isrollingrandomly=!1,isheadingchanging=!1,prog1set=!1,lastcitysantavillage=!1,roll=0,currentunixtimeinmiliseconds=0;async function fetchUnixTime(){try{var e=await fetch("https://api.master-trackers.xyz/time");if(!e.ok)throw new Error("Failed to fetch time");var t=await e.json();currentunixtimeinmiliseconds=t.unixTime,setInterval(()=>{currentunixtimeinmiliseconds+=1e3},1e3)}catch(e){console.error("Error fetching time:",e)}}fetchUnixTime(),(async()=>{try{var e=await fetch("https://temp.master-trackers.xyz/images");if(!e.ok)throw new Error("Network response was not ok: "+e.statusText);imageData=await e.json()}catch(e){console.error("Error fetching the JSON:",e),warnuserError("Error","There was an error getting the route images.")}})();var timeLeftValue=0;let presentsdeliverednumber;async function getLatLongFromIPAddress(){var e,t;if(localStorage.getItem("storedIP"))return e=localStorage.getItem("latitude"),t=localStorage.getItem("longitude"),{latitude:parseFloat(e),longitude:parseFloat(t)};try{var i=await(await fetch("https://ipapi.co/json/")).json();return localStorage.setItem("storedIP",!0),localStorage.setItem("latitude",i.latitude),localStorage.setItem("longitude",i.longitude),{latitude:i.latitude,longitude:i.longitude}}catch(e){return console.error("Error getting latitude and longitude:",e),warnuserError("Error","There was an error getting data for the arrival time."),null}}function handleCesiumIonError(e){console.error("Cesium Ion Error:",e),viewer&&location.reload()}function toggleSettings(){var e=document.getElementById("settingsPopup");"block"===e.style.display?e.style.display="none":e.style.display="block"}function getFlagImageUrl(e){return e.startsWith("http://")||e.startsWith("https://")?e:`https://flagcdn.com/w320/${e.toLowerCase()}.png`}let basketUpdateInterval,basketElement=document.getElementById("basketsInfo"),currentCountry,currentCount=0;function startBasketCounter(e,t,i){e=Number(e),t=Number(t),i=Number(i);let a={count:t};TweenLite.to(a,e,{count:i,ease:power2,onUpdate:function(){basketElement.textContent=Math.round(a.count).toLocaleString()},onComplete:function(){}})}function yourFunctionToRunWhenTrackerEnds(){source.close(),window.location.href="/"}Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIyM2Q1MWUyYS1kMDcxLTRmNmEtOWEwNC0wZTE4MjgzNmIyYWMiLCJpZCI6MTk2NTMyLCJpYXQiOjE3MDgzNzQ0NzJ9.GEf0dmAehNxx5LwDn4vzMd-XuwXVgAFXxvHB6IwUKNc";var viewer=new Cesium.Viewer("cesiumContainer",{terrain:Cesium.Terrain.fromWorldTerrain({requestWaterMask:!0}),skyAtmosphere:!1,baseLayerPicker:!1,shouldAnimate:!0});let googleMapsHybridUrl="https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",skyBox=(viewer.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:googleMapsHybridUrl})),viewer.clock.currentTime=Cesium.JulianDate.now(),new Cesium.SkyBox({sources:{positiveX:"/assets/black.png",negativeX:"/assets/black.png",positiveY:"/assets/black.png",negativeY:"/assets/black.png",positiveZ:"/assets/black.png",negativeZ:"/assets/black.png"}}));var currentLatitude=83.6;let citylocation213;var currentLongitude=168,targetLatitude=0,targetLongitude=0;function getRandomCoordinates(){return{lat:180*Math.random()-90,lon:360*Math.random()-180}}var santa2=viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(currentLongitude,currentLatitude,4e4),id:"santa2",model:{uri:"/assets/againsanta.gltf",scale:.6},orientation:Cesium.Transforms.headingPitchRollQuaternion(Cesium.Cartesian3.fromDegrees(currentLongitude,currentLatitude,4e4),new Cesium.HeadingPitchRoll(0,0,0))}),santa=viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(currentLongitude,currentLatitude,4e4),id:"santa",model:{uri:"/assets/invisible.glb",scale:.6},orientation:Cesium.Transforms.headingPitchRollQuaternion(Cesium.Cartesian3.fromDegrees(currentLongitude,currentLatitude,4e4),new Cesium.HeadingPitchRoll(0,0,0))});santa.allowPicking=!1;let alreadydone2=santa2.allowPicking=!1,pitch=0,angle=0,debounceTimeout;function updaterollrandomly(e,r,t){if(!debounceTimeout||0!=lastcitysantavillage){let n=/[zqxjk]/i.test(t);debounceTimeout=setTimeout(()=>{var e=Cesium.Cartesian3.fromDegrees(r[1],r[0]),t=santa.position.getValue(Cesium.JulianDate.now());let i=new Cesium.EllipsoidGeodesic(Cesium.Cartographic.fromCartesian(t),Cesium.Cartographic.fromCartesian(e)).startHeading-(Cesium.HeadingPitchRoll.fromQuaternion(santa.orientation.getValue(Cesium.JulianDate.now())).heading-Math.PI/2);i>Math.PI?i-=2*Math.PI:i<-Math.PI&&(i+=2*Math.PI);var a=i<0?-1:1;n||Math.random()},0)}}let frequency=1,amplitude=.09;function up(){TweenLite.to({progress:-amplitude},5,{progress:amplitude,ease:Power1.easeInOut,onUpdate:function(){pitch=this.target.progress},onComplete:function(){down()}})}function down(){TweenLite.to({progress:amplitude},5,{progress:-amplitude,ease:Linear.easeInOut,onUpdate:function(){pitch=this.target.progress},onComplete:function(){up()}})}up(),viewer.clock.clockRange=Cesium.ClockRange.LOOP_STOP,viewer.clock.multiplier=1,viewer.clock.shouldAnimate=!0;let scene=viewer.scene,currentPos,heading,hasRun1234124514=!1;!0===allowedtotrackedentity&&!0===trackeneityenabled&&(viewer.trackedEntity=santa);var validStepSize,allowedtofly2=!0,time12983748923714=0;function startValidStepSize(){setInterval(()=>{time12983748923714++},1e3)}let isrollingnow=!1,isTweening=!1,allowedtoroll=!0;var prog1=0;let ishead1=!1,hasRun1515=!1;function flyToSanta(u,c,d,e,t,i,m,a){if("number"!=typeof d||d<=0)console.error("Invalid time value");else{power2=e.includes("z")||e.includes("k")||e.includes("q")||e.includes("x")||e.includes("j")?alastthestop5.includes("z")||alastthestop5.includes("k")||alastthestop5.includes("j")||alastthestop5.includes("q")||alastthestop5.includes("x")?(power=Power1.easeInOut,Power2.easeInOut):(power=Power1.easeOut,Power2.easeOut):alastthestop5.includes("z")||alastthestop5.includes("k")||alastthestop5.includes("j")||alastthestop5.includes("q")||alastthestop5.includes("x")?(power=Power1.easeIn,Power2.easeIn):(power=Linear.easeNone,Linear.easeNone),o(),window.addEventListener("storage",function(e){"locationHid"===e.key&&o()});var n,r=Cesium.JulianDate.now(),y=(Cesium.JulianDate.addSeconds(r,d,new Cesium.JulianDate),60*d),p=Cesium.Cartographic.fromDegrees(t,i,4e4*a),g=Cesium.Cartographic.fromDegrees(c,u,4e4*m),v=new Cesium.EllipsoidGeodesic(p,g),h=0;hasRun1515||(heading=v.startHeading+(Math.PI+Math.PI/2)+Math.PI/365*2,hasRun1515=!0);let l=!1;var C=setInterval(function(){if(y<h)clearInterval(C);else if(e===citylocation213){function o(e){roll=e}isTweening||((isTweening=!0)===prog1set&&(prog1=0),allowedtoroll=!1,TweenLite.to({progress:prog1},d,{progress:1,ease:power,onUpdate:function(){var e,t,i;!1===ishead1&&(e=Cesium.Cartographic.fromDegrees(c,u,4e4*m),i=santa.position.getValue(Cesium.JulianDate.now()),i=Cesium.Ellipsoid.WGS84.cartesianToCartographic(i),i=new Cesium.EllipsoidGeodesic(i,e).startHeading-Math.PI+Math.PI/2+Math.PI/365*2,heading=i),e=this.target.progress,(i=v.interpolateUsingFraction(e))?(t=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,15020),i=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,15e3),santa.position=t,santa2.position=i,santaOverlay.position=t):console.error("currentPos is undefined at progress:",e)},onComplete:function(){isTweening=!1,allowedtohead=!0,allowedtoroll=!0}}));let e=heading,t=v.startHeading-Math.PI+Math.PI/2+Math.PI/365*2,i=t-e,a=0,n=(Cesium.Math.toRadians(.864699),Cesium.Math.toRadians(15e-5),Cesium.Math.toRadians(3));var s=Cesium.Math.toRadians(30);let r;Math.abs(i)>n&&!0===allowedtohead&&(isheadingchanging||(!1===l?(l=!0,isheadingchanging=!0,i<2*Math.PI*-1?(r=-s,a=-1*(-6.28-i)):i<0&&(r=s,a=-1*(-6.28-i)),TweenLite.to({progress:0},1,{progress:r,ease:Linear.ease,onUpdate:function(){isrollingnow=!0,o(this.target.progress)},onComplete:function(){}}),TweenLite.to({progress:e},7,{progress:v.startHeading+(Math.PI+Math.PI/2)+Math.PI/365*2,ease:Linear.easeInOut,onUpdate:function(){var e;ishead1=!0,e=this.target.progress,heading=e},onComplete:function(){ishead1=!1,TweenLite.to({progress:roll},1,{progress:0,ease:Linear.ease,onUpdate:function(){o(this.target.progress)},onComplete:function(){isrollingnow=!1}})}}),isheadingchanging=!1):hasRun1234124514||(new Cesium.EllipsoidGeodesic(p,g),hasRun1234124514=!0,allowedtohead=!1,allowedtofly2=!0,0))),h++}},1e3*d/y);function o(){var e=localStorage.getItem("locationHid"),e=(n="true"===e,document.getElementById("hidelocation"));e.style.display=n?"none":"block"}!0===allowedtotrackedentity&&!0===trackeneityenabled&&(viewer.trackedEntity=santa)}}function myFunctio2(){var e=Cesium.JulianDate.now();santa2.orientation=Cesium.Transforms.headingPitchRollQuaternion(santa2.position.getValue(e),new Cesium.HeadingPitchRoll(heading,pitch,roll)),santa.orientation=Cesium.Transforms.headingPitchRollQuaternion(santa.position.getValue(e),new Cesium.HeadingPitchRoll(heading,pitch,roll)),santaOverlay.orientation=Cesium.Transforms.headingPitchRollQuaternion(santa.position.getValue(e),new Cesium.HeadingPitchRoll(heading,pitch,roll))}setInterval(myFunctio2,30);var nobaskets=url.searchParams.get("nobaskets");async function fetchBaskets(){try{(await(await fetch("/getbaskets")).json()).forEach(e=>{addBasket(e)})}catch(e){console.error("Error fetching baskets:",e),warnuserError("Error","There was an error getting old gifts delivered.")}}function celsiusToFahrenheit(e){return 9*e/5+32}function truncateText(e,t){return e.length>t?e.substring(0,t)+"...":e}function roundToThreeDecimalPlaces(e){return parseFloat(e).toFixed(1)}"1"!==nobaskets&&fetchBaskets(),viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);let billboardCollection=new Cesium.BillboardCollection({scene:viewer.scene,maximumBillboards:1078});function addBasket(t){var e;"pt"===t.country||placedBaskets.some(e=>e[0]===t.latitude&&e[1]===t.longitude)||(placedBaskets.push([t.latitude,t.longitude]),e=t.Wikipedia_attr.includes("youtube.com")?"/assets/camera.png":"/assets/present.png",viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(t.longitude,t.latitude,15e3),billboard:{image:e,scale:.1},cityInfo:t}))}function showPopup(e){var t=document.getElementById("custom-close-btn");let i=document.getElementById("custom-popup-container");t.addEventListener("click",function(){i.style.display="none"});t=document.getElementById("custom-popup-content");i&&t?(t.innerHTML=e,i.style.display="block"):console.error("Popup elements not found!")}viewer.scene.primitives.add(billboardCollection);let handler=new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);handler.setInputAction(function(e){var t,i,a,e=viewer.scene.pick(e.position);Cesium.defined(e)&&e.id&&e.id.cityInfo&&(t=e.id.cityInfo,e=e.id.position.getValue(Cesium.JulianDate.now()),e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(viewer.scene,e),a=t.Wikipedia_attr.includes("youtube.com")?(i=t.Wikipedia_attr,(a=i.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+|(?:v|e(?:mbed)?)\/([^"&?\/\s]*))|(?:watch\?v=([^"&?\/\s]*)))|(?:youtu\.be\/([^"&?\/\s]*))/i))?`https://www.youtube.com/embed/${a[1]||a[2]||a[3]}?autoplay=1`:i):t.Wikipedia_attr,showPopup(`
  <div style="font-family: Arial, sans-serif;">
    <div style="display: flex; align-items: center;">
      <img 
        src="https://flagcdn.com/w40/${t.cc.toLowerCase()}.png" 
        alt="${t.country} flag" 
        style="height: 1em; margin-right: 8px;"
      />
      <b>${t.city}, ${t.country}</b>
    </div>
    <div><strong>Arrival Time:</strong> ${new Date(1e3*t.unixarrivalarrival).toLocaleString()}</div>
    <div><strong>Weather on Arrival:</strong> ${i=t,t=i.weather&&i.weather.temperature,null==t?"Come back later for weather information.":"Fahrenheit"==("en-US"===Intl.DateTimeFormat().resolvedOptions().locale?"Fahrenheit":"Celsius")?(9*t/5+32).toFixed(1)+" °F, it was "+i.weather.description.toLowerCase():t.toFixed(1)+" °C, it was "+i.weather.description.toLowerCase()}</div>
    <div>
      <iframe src="${a}" width="100%" max-width="900px" height="600px;" max-height="600px"></iframe>
    </div>
  </div>
`,e))},Cesium.ScreenSpaceEventType.LEFT_CLICK);let arrivalTime;async function getTimeOfArrival(e,t){try{var i=await(await fetch(`/gettimeuntilarrival?lat=${e}&long=`+t)).json();return arrivalTime=i.arrivalTime,i}catch(e){return console.error("Error getting time of arrival:",e),warnuserError("Error","There was an error fetching the time of arrival."),null}}function formatTimeUntilArrival(t){t/=3600;if(t<1)return(i=Math.round(60*t))%15==0?i/60+" hour"+(i/60!=1?"s":""):0===Math.ceil(t)?"Less than 15 minutes!":(Math.floor(i/15),Math.round(t)+" hour"+(1!==Math.round(t)?"s":""));if(1==t)return"1 hour";{var i=Math.floor(t),t=Math.round(60*(t-i));let e="";return e=0===t?i+" hour"+(1===i?"":"s"):15===t?i+" ¼ hour":30===t?i+" ½ hour":45===t?i+" ¾ hour":i+` ${i=Math.round(t/15)}/4 hour`+(1!==i?"s":"")}}function updateArrivalTimeDisplay(){var e;arrivalTime&&(e=Math.floor(arrivalTime-new Date(currentunixtimeinmiliseconds)/1e3),document.getElementById("arrivalTime").innerText=0<=e?"Santa will arrive in: "+formatTimeUntilArrival(e):`Santa arrived ${formatTimeUntilArrival(-e)} ago`)}async function main(){try{var{latitude:e,longitude:t}=await getLatLongFromIPAddress();e&&t?(await getTimeOfArrival(e,t),updateArrivalTimeDisplay(),setInterval(updateArrivalTimeDisplay,1e3)):console.error("Latitude and longitude not available.")}catch(e){console.error("An error occurred:",e),warnuserError("Error","There was an error getting data for arrival time.")}}async function fetchRouteData(){try{var t=await fetch("/route");if(!t.ok)throw new Error("Network response was not ok: "+t.statusText);let e=await t.text();setInterval(()=>{handleSSE(processRouteData(parseRouteData(e)))},1e3)}catch(e){console.error("Error fetching route data:",e),warnuserError("Error","There was an error getting the route data.")}}function runFetchAtNextSecond(){var e=1e3-new Date(currentunixtimeinmiliseconds).getMilliseconds();setTimeout(()=>{fetchRouteData()},e)}main(),runFetchAtNextSecond();let hasHandledNoNextCity=!1;function parseRouteData(e){try{return JSON.parse(e)}catch(e){return console.error("Error parsing route data:",e),warnuserError("Error","There was an error parsing the route data."),[]}}let hasStarted=!1;function processRouteData(t){var i=Math.floor(new Date(currentunixtimeinmiliseconds)/1e3);let a=null,n=null,r=null,o=null;for(let e=0;e<t.length;e++){var s=t[e],l=s["Unix Arrival Arrival"];if(l&&!isNaN(l)){if(n&&(r=n),i<l){a=s,n=n||s,e+1<t.length&&(l=t[e+1],o=l);break}n=s}}function e(e,t){t=e.entities.getById(t);t&&e.entities.remove(t)}return!a&&n&&(r=n),a&&!hasStarted&&(startallowed=!0,startview(),hasStarted=!0),n=n||{},a||(document.getElementById("endingtext").style.visibility="visible",document.getElementById("hideavailable").style.visibility="hidden",document.getElementById("lastseeninfobox").style.visibility="hidden",document.getElementById("lastseeninfobox3").style.visibility="hidden",e(viewer,"santa"),e(viewer,"santa2"),hasHandledNoNextCity||(hasHandledNoNextCity=!0,startallowed=!1,handleNoNextCity()),setInterval(()=>{e(viewer,"santa"),e(viewer,"santa2"),e(viewer,"santaoverlaythingy")},1e3)),convertData({currentCity:extractCityData(n),timeLeft:calculateTimeLeft(a),nextCity:extractCityData(a||n),nextNextCity:extractCityData(o||n),lastCity:extractCityData(r),newBasket:extractCityData(n)})}function handleNoNextCity(){allowedtotrackedentity=!1,trackeneityenabled=!1,viewer.trackedEntity=void 0,setTimeout(()=>{viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(0,0,3e7),duration:3})},1e3),setTimeout(()=>{deleteEntityById(viewer,"santaOverlay")},1e4)}let obj={trackeneityenabled:!1},handler2={set(e,t,i){return"trackeneityenabled"!==t||i||disableTracking(),e[t]=i,!0}},proxy=new Proxy(obj,handler2);function disableTracking(){viewer.trackedEntity=void 0,setTimeout(()=>{viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(0,0,3e7),duration:3})},1e3)}function triggerFunctions(){!0===trackeneityenabled?(trackeneityenabled=!1,document.getElementById("FollowButtonImage").src="/assets/followcam.png",disableTracking()):(document.getElementById("FollowButtonImage").src="/assets/unfollowicon.png",trackeneityenabled=!0,viewer.trackedEntity=santa)}function extractCityData(e){return{unixArrivalArrival:e["Unix Arrival Arrival"]||0,unixArrival:e["Unix Arrival"]||0,unixDeparture:e["Unix Departure"]||0,city:e.City||"Unknown",country:e.Region||"Unknown",cc:e.CC||"None",timezone:e.Timezone||"Unknown",basketsdelivered:e["Eggs Delivered"]||0,carrotsEaten:e["Carrots eaten"]||0,latitude:e.Latitude||"0",longitude:e.Longitude||"0",popNum:e["Population Num"]||0,popYear:e["Population Year"]||"Unknown",elevationMeter:e["Elevation Meter"]||0,arrivalStoppageTime:e["Arrival Stoppage Time"]||0,wikipediaAttr:e["Wikipedia attr"]||"None",wikipediaLink:e["Wikipedia Link"]||"None"}}function calculateTimeLeft(e){return(e?e["Unix Arrival Arrival"]:0)-Math.floor(new Date(currentunixtimeinmiliseconds)/1e3)}function convertData(e){return{currentCity:{unixarrivalarrival:e.currentCity.unixArrivalArrival,unixarrival:e.currentCity.unixArrival,unixdeparture:e.currentCity.unixDeparture,city:e.currentCity.city,country:e.currentCity.country,cc:e.currentCity.cc,timezone1:e.currentCity.timezone,basketsdelivered:e.currentCity.basketsdelivered,carrots_eaten:e.currentCity.carrotsEaten,latitude:e.currentCity.latitude,longitude:e.currentCity.longitude,pop_num:e.currentCity.popNum,pop_year:e.currentCity.popYear,Elevation_Meter:e.currentCity.elevationMeter,Arrival_Stoppage_Time:e.currentCity.arrivalStoppageTime,timezone:e.currentCity.timezone,Wikipedia_attr:e.currentCity.wikipediaAttr,wikipedia_link:e.currentCity.wikipediaLink},timeLeft:e.timeLeft,nextCity:{unixarrivalarrival:e.nextCity.unixArrivalArrival,unixarrival:e.nextCity.unixArrival,unixdeparture:e.nextCity.unixDeparture,city:e.nextCity.city,country:e.nextCity.country,cc:e.nextCity.cc,timezone1:e.nextCity.timezone,basketsdelivered:e.nextCity.basketsdelivered,carrots_eaten:e.nextCity.carrotsEaten,latitude:e.nextCity.latitude,longitude:e.nextCity.longitude,pop_num:e.nextCity.popNum,pop_year:e.nextCity.popYear,Elevation_Meter:e.nextCity.elevationMeter,Arrival_Stoppage_Time:e.nextCity.arrivalStoppageTime,timezone:e.nextCity.timezone,Wikipedia_attr:e.nextCity.wikipediaAttr,wikipedia_link:e.nextCity.wikipediaLink},nextNextCity:{unixarrivalarrival:e.nextNextCity.unixArrivalArrival,unixarrival:e.nextNextCity.unixArrival,unixdeparture:e.nextNextCity.unixDeparture,city:e.nextNextCity.city,country:e.nextNextCity.country,cc:e.nextNextCity.cc,timezone1:e.nextNextCity.timezone,basketsdelivered:e.nextNextCity.basketsdelivered,carrots_eaten:e.nextNextCity.carrotsEaten,latitude:e.nextNextCity.latitude,longitude:e.nextNextCity.longitude,pop_num:e.nextNextCity.popNum,pop_year:e.nextNextCity.popYear,Elevation_Meter:e.nextNextCity.elevationMeter,Arrival_Stoppage_Time:e.nextNextCity.arrivalStoppageTime,timezone:e.nextNextCity.timezone,Wikipedia_attr:e.nextNextCity.wikipediaAttr,wikipedia_link:e.nextNextCity.wikipediaLink},lastCity:{unixarrivalarrival:e.lastCity.unixArrivalArrival,unixarrival:e.lastCity.unixArrival,unixdeparture:e.lastCity.unixDeparture,city:e.lastCity.city,country:e.lastCity.country,cc:e.lastCity.cc,timezone1:e.lastCity.timezone,basketsdelivered:e.lastCity.basketsdelivered,carrots_eaten:e.lastCity.carrotsEaten,latitude:e.lastCity.latitude,longitude:e.lastCity.longitude,pop_num:e.lastCity.popNum,pop_year:e.lastCity.popYear,Elevation_Meter:e.lastCity.elevationMeter,Arrival_Stoppage_Time:e.lastCity.arrivalStoppageTime,timezone:e.lastCity.timezone,Wikipedia_attr:e.lastCity.wikipediaAttr,wikipedia_link:e.lastCity.wikipediaLink},newBasket:{unixarrivalarrival:e.newBasket.unixArrivalArrival,unixarrival:e.newBasket.unixArrival,unixdeparture:e.newBasket.unixDeparture,city:e.newBasket.city,country:e.newBasket.country,cc:e.newBasket.cc,timezone1:e.newBasket.timezone,basketsdelivered:e.newBasket.basketsdelivered,carrots_eaten:e.newBasket.carrotsEaten,latitude:e.newBasket.latitude,longitude:e.newBasket.longitude,pop_num:e.newBasket.popNum,pop_year:e.newBasket.popYear,Elevation_Meter:e.newBasket.elevationMeter,Arrival_Stoppage_Time:e.newBasket.arrivalStoppageTime,timezone:e.newBasket.timezone,Wikipedia_attr:e.newBasket.wikipediaAttr,wikipedia_link:e.newBasket.wikipediaLink}}}let debounceTimeout2,presetCityUrl="https://theelevatedmoments.com/wp-content/uploads/2023/12/A63I8240.jpg",lastCity44444=null;function setCityImage(e){var t,i;debounceTimeout2||lastCity44444===e||(t=document.getElementById("flag3"),imageData[e]&&0<imageData[e].length?(i=(i=imageData[e])[Math.floor(Math.random()*i.length)],t.src=i.url,t.setAttribute("alt","Image for "+e),document.getElementById("lastCityInfo3").innerHTML="© "+i.attribution):(t.src=presetCityUrl,t.setAttribute("alt","Default city image"),document.getElementById("lastCityInfo3").innerHTML="No image available."),lastCity44444=e,debounceTimeout2=setTimeout(()=>{debounceTimeout2=null},2e4))}function handleSSE(e){let t;if("string"==typeof e)try{t=JSON.parse(e)}catch(e){return console.error("Error parsing event data:",e),void warnuserError("Error","An unknown error occured.")}else{if("object"!=typeof e)return console.error("Unexpected event format:",e),void warnuserError("Error","An unknown error occured.");t=e}function i(e){var t=Math.floor(e/31536e3),i=(e-=3600*t*24*365,Math.floor(e/86400)),a=(e-=3600*i*24,Math.floor(e/3600)),n=(e-=3600*a,Math.floor(e/60));e-=60*n;let r="";return 0<t&&(r+=t+` year${1<t?"s":""} `),0<i&&(r+=i+` day${1<i?"s":""} `),0<a&&(r+=a+` hour${1<a?"s":""} `),0<n&&(r+=n+` minute${1<n?"s":""} `),0<e&&(r+=e+" second"+(1<e?"s":"")),r.trim()}hereyecomesthestop5=t.nextNextCity.city,!0===startallowed&&(parseInt(t.timeLeft,10)<=parseInt(t.currentCity.Arrival_Stoppage_Time,10)?(isrollingrandomly=!0,t.nextNextCity.latitude,t.nextNextCity.longitude):isrollingrandomly=!1,!0===t.trackerended&&window.open("/"),citylocation213=t.nextCity.city,timeLeftValue=t.timeLeft,t.trackerEnded,t.nextCity)&&(nobaskets||t.lastCity&&addBasket(t.lastCity),"pt"===t.lastCity.country?(setInterval(()=>{var e,t=new Date(currentunixtimeinmiliseconds),i=new Date(t),i=(i.setUTCHours(9,0,0,0),9<=t.getUTCHours()&&i.setUTCDate(t.getUTCDate()+1),i-t);i<0||(t=Math.floor(i%864e5/36e5),e=Math.floor(i%36e5/6e4),i=Math.floor(i%6e4/1e3),document.getElementById("launchTimer").textContent=t.toString().padStart(2,"0")+":"+e.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0"))},1e3),document.getElementById("hideavailable").hidden=!0,document.getElementById("launchID").hidden=!1):(document.getElementById("hideavailable").hidden=!1,document.getElementById("launchID").hidden=!0),document.getElementById("nextCityInfo").textContent=t.nextCity?!(t.timeLeft<=parseInt(t.currentCity.Arrival_Stoppage_Time))&&t.nextCity.country.endsWith('"')&&t.nextCity.country.includes("pt")?""+t.nextCity.country.replace(/^"(.*)"$/,"$1"):`${t.nextCity.city.replace(/^"(.*)"$/,"$1")}, ${t.nextCity.country.replace(/^"(.*)"$/,"$1")} in ${i(t.timeLeft)}.`:"",t.timeLeft<=parseInt(t.currentCity.Arrival_Stoppage_Time)?(iscurrentlydelivering=!0,santaOverlay.billboard.image="/assets/santaoverlay.png",moving=!0,stopped=!0):(iscurrentlydelivering=!1,stopped=!0,moving=!0,santaOverlay.billboard.image="/assets/santaoverlay.png"),timeleft2=t.timeLeft,document.getElementById("lastCityInfo").textContent=t.lastCity?`${t.lastCity.city}${e=t.lastCity.country,e.toLowerCase().includes("pt")?"":","} `+((e=t.lastCity.country).endsWith("pt")?e.slice(0,-2):e.replace(/"/g,"")):"",e=t.nextCity.city,!1===prog1set&&(prog1=parseInt(t.lastCity.unixarrivalarrival)/parseInt(t.nextCity.unixarrivalarrival),prog1set=!0),setCityImage(e),document.getElementById("flag3"),e=getFlagImageUrl(t.nextCity.cc),document.getElementById("flag").src=e,e=getFlagImageUrl(t.lastCity.cc),document.getElementById("flag2").src=e,"pt"!==t.lastCity.country.toLowerCase()==0?document.getElementById("hideavailable").style.display="none":document.getElementById("hideavailable").style.display="block",alastthestop5=t.lastCity.city,t.lastCity.city!==lastcitystopped)&&(startBasketCounter(t.timeLeft,t.lastCity.basketsdelivered,t.nextCity.basketsdelivered),lastcitystopped=t.lastCity.city,flyToSanta(t.nextCity.latitude,t.nextCity.longitude,t.timeLeft,t.nextCity.city,t.lastCity.longitude,t.lastCity.latitude))}let cityInfo={longitude:-75.59777,latitude:40.03883},santaOverlay=viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(cityInfo.longitude,cityInfo.latitude),billboard:{image:"/assets/santaoverlay.png",width:50,height:50,show:!1},EyeOffset:new Cesium.Cartesian3(0,0,15e3),id:"santaoverlaythingy"});function startview(){setTimeout(()=>{var e;santa&&santa.position?(e=santa.position.getValue(Cesium.JulianDate.now()))?(viewer.camera.flyTo({destination:e,duration:3}),setTimeout(()=>{allowedtotrackedentity=!0,viewer.trackedEntity=santa;e="eyeoffset";var e=new URL(window.location.href).searchParams.get(e),e=e?1e3*parseFloat(e):300;viewer.scene.screenSpaceCameraController.minimumZoomDistance=e,setTimeout(()=>{viewer.scene.screenSpaceCameraController.minimumZoomDistance=1},3e3)},3300)):console.error("Santa position is not valid."):console.error("Santa entity or position is not defined.")},2500)}santaOverlay.allowPicking=!1,viewer.camera.changed.addEventListener(()=>{var e=viewer.camera.getMagnitude();santaOverlay.billboard.show=1e5<e}),viewer.scene.skyBox=skyBox,Cesium.Ion.onError=handleCesiumIonError;